{"dependencies":[{"name":"domhandler","data":{"isAsync":false}},{"name":"domutils","data":{"isAsync":false}},{"name":"inherits","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var DomHandler = _$$_REQUIRE(_dependencyMap[0], \"domhandler\");\n\n  var DomUtils = _$$_REQUIRE(_dependencyMap[1], \"domutils\");\n\n  function FeedHandler(callback, options) {\n    this.init(callback, options);\n  }\n\n  _$$_REQUIRE(_dependencyMap[2], \"inherits\")(FeedHandler, DomHandler);\n\n  FeedHandler.prototype.init = DomHandler;\n\n  function getElements(what, where) {\n    return DomUtils.getElementsByTagName(what, where, true);\n  }\n\n  function getOneElement(what, where) {\n    return DomUtils.getElementsByTagName(what, where, true, 1)[0];\n  }\n\n  function fetch(what, where, recurse) {\n    return DomUtils.getText(DomUtils.getElementsByTagName(what, where, recurse, 1)).trim();\n  }\n\n  function addConditionally(obj, prop, what, where, recurse) {\n    var tmp = fetch(what, where, recurse);\n    if (tmp) obj[prop] = tmp;\n  }\n\n  var isValidFeed = function isValidFeed(value) {\n    return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n  };\n\n  FeedHandler.prototype.onend = function () {\n    var feed = {},\n        feedRoot = getOneElement(isValidFeed, this.dom),\n        tmp,\n        childs;\n\n    if (feedRoot) {\n      if (feedRoot.name === \"feed\") {\n        childs = feedRoot.children;\n        feed.type = \"atom\";\n        addConditionally(feed, \"id\", \"id\", childs);\n        addConditionally(feed, \"title\", \"title\", childs);\n        if ((tmp = getOneElement(\"link\", childs)) && (tmp = tmp.attribs) && (tmp = tmp.href)) feed.link = tmp;\n        addConditionally(feed, \"description\", \"subtitle\", childs);\n        if (tmp = fetch(\"updated\", childs)) feed.updated = new Date(tmp);\n        addConditionally(feed, \"author\", \"email\", childs, true);\n        feed.items = getElements(\"entry\", childs).map(function (item) {\n          var entry = {},\n              tmp;\n          item = item.children;\n          addConditionally(entry, \"id\", \"id\", item);\n          addConditionally(entry, \"title\", \"title\", item);\n          if ((tmp = getOneElement(\"link\", item)) && (tmp = tmp.attribs) && (tmp = tmp.href)) entry.link = tmp;\n          if (tmp = fetch(\"summary\", item) || fetch(\"content\", item)) entry.description = tmp;\n          if (tmp = fetch(\"updated\", item)) entry.pubDate = new Date(tmp);\n          return entry;\n        });\n      } else {\n        childs = getOneElement(\"channel\", feedRoot.children).children;\n        feed.type = feedRoot.name.substr(0, 3);\n        feed.id = \"\";\n        addConditionally(feed, \"title\", \"title\", childs);\n        addConditionally(feed, \"link\", \"link\", childs);\n        addConditionally(feed, \"description\", \"description\", childs);\n        if (tmp = fetch(\"lastBuildDate\", childs)) feed.updated = new Date(tmp);\n        addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n        feed.items = getElements(\"item\", feedRoot.children).map(function (item) {\n          var entry = {},\n              tmp;\n          item = item.children;\n          addConditionally(entry, \"id\", \"guid\", item);\n          addConditionally(entry, \"title\", \"title\", item);\n          addConditionally(entry, \"link\", \"link\", item);\n          addConditionally(entry, \"description\", \"description\", item);\n          if (tmp = fetch(\"pubDate\", item)) entry.pubDate = new Date(tmp);\n          return entry;\n        });\n      }\n    }\n\n    this.dom = feed;\n\n    DomHandler.prototype._handleCallback.call(this, feedRoot ? null : Error(\"couldn't find root of feed\"));\n  };\n\n  module.exports = FeedHandler;\n});","map":[[2,0,1,0],[2,6,1,4,"DomHandler"],[2,16,1,14],[2,19,1,17,"require"],[2,30,1,24],[2,63,1,0],[4,0,2,0],[4,6,2,4,"DomUtils"],[4,14,2,12],[4,17,2,15,"require"],[4,28,2,22],[4,59,2,0],[6,0,5,0],[6,11,5,9,"FeedHandler"],[6,22,5,0],[6,23,5,21,"callback"],[6,31,5,0],[6,33,5,31,"options"],[6,40,5,0],[6,42,5,40],[7,0,6,4],[7,9,6,9,"init"],[7,13,6,4],[7,14,6,14,"callback"],[7,22,6,4],[7,24,6,24,"options"],[7,31,6,4],[8,0,7,1],[10,0,9,0,"require"],[10,2,9,0,"require"],[10,13,9,7],[10,44,9,0],[10,45,9,20,"FeedHandler"],[10,56,9,0],[10,58,9,33,"DomHandler"],[10,68,9,0],[12,0,11,0,"FeedHandler"],[12,2,11,0,"FeedHandler"],[12,13,11,11],[12,14,11,12,"prototype"],[12,23,11,0],[12,24,11,22,"init"],[12,28,11,0],[12,31,11,29,"DomHandler"],[12,41,11,0],[14,0,13,0],[14,11,13,9,"getElements"],[14,22,13,0],[14,23,13,21,"what"],[14,27,13,0],[14,29,13,27,"where"],[14,34,13,0],[14,36,13,34],[15,0,14,4],[15,11,14,11,"DomUtils"],[15,19,14,19],[15,20,14,20,"getElementsByTagName"],[15,40,14,11],[15,41,14,41,"what"],[15,45,14,11],[15,47,14,47,"where"],[15,52,14,11],[15,54,14,54],[15,58,14,11],[15,59,14,4],[16,0,15,1],[18,0,16,0],[18,11,16,9,"getOneElement"],[18,24,16,0],[18,25,16,23,"what"],[18,29,16,0],[18,31,16,29,"where"],[18,36,16,0],[18,38,16,36],[19,0,17,4],[19,11,17,11,"DomUtils"],[19,19,17,19],[19,20,17,20,"getElementsByTagName"],[19,40,17,11],[19,41,17,41,"what"],[19,45,17,11],[19,47,17,47,"where"],[19,52,17,11],[19,54,17,54],[19,58,17,11],[19,60,17,60],[19,61,17,11],[19,63,17,63],[19,64,17,11],[19,65,17,4],[20,0,18,1],[22,0,19,0],[22,11,19,9,"fetch"],[22,16,19,0],[22,17,19,15,"what"],[22,21,19,0],[22,23,19,21,"where"],[22,28,19,0],[22,30,19,28,"recurse"],[22,37,19,0],[22,39,19,37],[23,0,20,4],[23,11,20,11,"DomUtils"],[23,19,20,19],[23,20,20,20,"getText"],[23,27,20,11],[23,28,21,8,"DomUtils"],[23,36,21,16],[23,37,21,17,"getElementsByTagName"],[23,57,21,8],[23,58,21,38,"what"],[23,62,21,8],[23,64,21,44,"where"],[23,69,21,8],[23,71,21,51,"recurse"],[23,78,21,8],[23,80,21,60],[23,81,21,8],[23,82,20,11],[23,84,22,6,"trim"],[23,88,20,11],[23,90,20,4],[24,0,23,1],[26,0,25,0],[26,11,25,9,"addConditionally"],[26,27,25,0],[26,28,25,26,"obj"],[26,31,25,0],[26,33,25,31,"prop"],[26,37,25,0],[26,39,25,37,"what"],[26,43,25,0],[26,45,25,43,"where"],[26,50,25,0],[26,52,25,50,"recurse"],[26,59,25,0],[26,61,25,59],[27,0,26,4],[27,8,26,8,"tmp"],[27,11,26,11],[27,14,26,14,"fetch"],[27,19,26,19],[27,20,26,20,"what"],[27,24,26,19],[27,26,26,26,"where"],[27,31,26,19],[27,33,26,33,"recurse"],[27,40,26,19],[27,41,26,4],[28,0,27,4],[28,8,27,8,"tmp"],[28,11,27,4],[28,13,27,13,"obj"],[28,16,27,16],[28,17,27,17,"prop"],[28,21,27,16],[28,22,27,13],[28,25,27,25,"tmp"],[28,28,27,13],[29,0,28,1],[31,0,30,0],[31,6,30,4,"isValidFeed"],[31,17,30,15],[31,20,30,18],[31,29,30,4,"isValidFeed"],[31,40,30,18],[31,41,30,27,"value"],[31,46,30,18],[31,48,30,34],[32,0,31,4],[32,11,31,11,"value"],[32,16,31,16],[32,21,31,21],[32,26,31,11],[32,30,31,30,"value"],[32,35,31,35],[32,40,31,40],[32,46,31,11],[32,50,31,50,"value"],[32,55,31,55],[32,60,31,60],[32,69,31,4],[33,0,32,1],[33,3,30,0],[35,0,34,0,"FeedHandler"],[35,2,34,0,"FeedHandler"],[35,13,34,11],[35,14,34,12,"prototype"],[35,23,34,0],[35,24,34,22,"onend"],[35,29,34,0],[35,32,34,30],[35,44,34,41],[36,0,35,4],[36,8,35,8,"feed"],[36,12,35,12],[36,15,35,15],[36,17,35,4],[37,0,35,4],[37,8,36,8,"feedRoot"],[37,16,36,16],[37,19,36,19,"getOneElement"],[37,32,36,32],[37,33,36,33,"isValidFeed"],[37,44,36,32],[37,46,36,46],[37,51,36,51,"dom"],[37,54,36,32],[37,55,35,4],[38,0,35,4],[38,8,37,8,"tmp"],[38,11,35,4],[39,0,35,4],[39,8,38,8,"childs"],[39,14,35,4],[41,0,40,4],[41,8,40,8,"feedRoot"],[41,16,40,4],[41,18,40,18],[42,0,41,8],[42,10,41,12,"feedRoot"],[42,18,41,20],[42,19,41,21,"name"],[42,23,41,12],[42,28,41,30],[42,34,41,8],[42,36,41,38],[43,0,42,12,"childs"],[43,8,42,12,"childs"],[43,14,42,18],[43,17,42,21,"feedRoot"],[43,25,42,29],[43,26,42,30,"children"],[43,34,42,12],[44,0,44,12,"feed"],[44,8,44,12,"feed"],[44,12,44,16],[44,13,44,17,"type"],[44,17,44,12],[44,20,44,24],[44,26,44,12],[45,0,45,12,"addConditionally"],[45,8,45,12,"addConditionally"],[45,24,45,28],[45,25,45,29,"feed"],[45,29,45,28],[45,31,45,35],[45,35,45,28],[45,37,45,41],[45,41,45,28],[45,43,45,47,"childs"],[45,49,45,28],[45,50,45,12],[46,0,46,12,"addConditionally"],[46,8,46,12,"addConditionally"],[46,24,46,28],[46,25,46,29,"feed"],[46,29,46,28],[46,31,46,35],[46,38,46,28],[46,40,46,44],[46,47,46,28],[46,49,46,53,"childs"],[46,55,46,28],[46,56,46,12],[47,0,47,12],[47,12,48,16],[47,13,48,17,"tmp"],[47,16,48,20],[47,19,48,23,"getOneElement"],[47,32,48,36],[47,33,48,37],[47,39,48,36],[47,41,48,45,"childs"],[47,47,48,36],[47,48,48,16],[47,54,49,17,"tmp"],[47,57,49,20],[47,60,49,23,"tmp"],[47,63,49,26],[47,64,49,27,"attribs"],[47,71,48,16],[47,77,50,17,"tmp"],[47,80,50,20],[47,83,50,23,"tmp"],[47,86,50,26],[47,87,50,27,"href"],[47,91,48,16],[47,92,47,12],[47,94,52,16,"feed"],[47,98,52,20],[47,99,52,21,"link"],[47,103,52,16],[47,106,52,28,"tmp"],[47,109,52,16],[48,0,53,12,"addConditionally"],[48,8,53,12,"addConditionally"],[48,24,53,28],[48,25,53,29,"feed"],[48,29,53,28],[48,31,53,35],[48,44,53,28],[48,46,53,50],[48,56,53,28],[48,58,53,62,"childs"],[48,64,53,28],[48,65,53,12],[49,0,54,12],[49,12,54,17,"tmp"],[49,15,54,20],[49,18,54,23,"fetch"],[49,23,54,28],[49,24,54,29],[49,33,54,28],[49,35,54,40,"childs"],[49,41,54,28],[49,42,54,12],[49,44,54,50,"feed"],[49,48,54,54],[49,49,54,55,"updated"],[49,56,54,50],[49,59,54,65],[49,63,54,69,"Date"],[49,67,54,65],[49,68,54,74,"tmp"],[49,71,54,65],[49,72,54,50],[50,0,55,12,"addConditionally"],[50,8,55,12,"addConditionally"],[50,24,55,28],[50,25,55,29,"feed"],[50,29,55,28],[50,31,55,35],[50,39,55,28],[50,41,55,45],[50,48,55,28],[50,50,55,54,"childs"],[50,56,55,28],[50,58,55,62],[50,62,55,28],[50,63,55,12],[51,0,57,12,"feed"],[51,8,57,12,"feed"],[51,12,57,16],[51,13,57,17,"items"],[51,18,57,12],[51,21,57,25,"getElements"],[51,32,57,36],[51,33,57,37],[51,40,57,36],[51,42,57,46,"childs"],[51,48,57,36],[51,49,57,25],[51,50,57,54,"map"],[51,53,57,25],[51,54,57,58],[51,64,57,67,"item"],[51,68,57,58],[51,70,57,73],[52,0,58,16],[52,14,58,20,"entry"],[52,19,58,25],[52,22,58,28],[52,24,58,16],[53,0,58,16],[53,14,59,20,"tmp"],[53,17,58,16],[54,0,61,16,"item"],[54,10,61,16,"item"],[54,14,61,20],[54,17,61,23,"item"],[54,21,61,27],[54,22,61,28,"children"],[54,30,61,16],[55,0,63,16,"addConditionally"],[55,10,63,16,"addConditionally"],[55,26,63,32],[55,27,63,33,"entry"],[55,32,63,32],[55,34,63,40],[55,38,63,32],[55,40,63,46],[55,44,63,32],[55,46,63,52,"item"],[55,50,63,32],[55,51,63,16],[56,0,64,16,"addConditionally"],[56,10,64,16,"addConditionally"],[56,26,64,32],[56,27,64,33,"entry"],[56,32,64,32],[56,34,64,40],[56,41,64,32],[56,43,64,49],[56,50,64,32],[56,52,64,58,"item"],[56,56,64,32],[56,57,64,16],[57,0,65,16],[57,14,66,20],[57,15,66,21,"tmp"],[57,18,66,24],[57,21,66,27,"getOneElement"],[57,34,66,40],[57,35,66,41],[57,41,66,40],[57,43,66,49,"item"],[57,47,66,40],[57,48,66,20],[57,54,67,21,"tmp"],[57,57,67,24],[57,60,67,27,"tmp"],[57,63,67,30],[57,64,67,31,"attribs"],[57,71,66,20],[57,77,68,21,"tmp"],[57,80,68,24],[57,83,68,27,"tmp"],[57,86,68,30],[57,87,68,31,"href"],[57,91,66,20],[57,92,65,16],[57,94,70,20,"entry"],[57,99,70,25],[57,100,70,26,"link"],[57,104,70,20],[57,107,70,33,"tmp"],[57,110,70,20],[58,0,71,16],[58,14,71,21,"tmp"],[58,17,71,24],[58,20,71,27,"fetch"],[58,25,71,32],[58,26,71,33],[58,35,71,32],[58,37,71,44,"item"],[58,41,71,32],[58,42,71,27],[58,46,71,53,"fetch"],[58,51,71,58],[58,52,71,59],[58,61,71,58],[58,63,71,70,"item"],[58,67,71,58],[58,68,71,16],[58,70,72,20,"entry"],[58,75,72,25],[58,76,72,26,"description"],[58,87,72,20],[58,90,72,40,"tmp"],[58,93,72,20],[59,0,73,16],[59,14,73,21,"tmp"],[59,17,73,24],[59,20,73,27,"fetch"],[59,25,73,32],[59,26,73,33],[59,35,73,32],[59,37,73,44,"item"],[59,41,73,32],[59,42,73,16],[59,44,74,20,"entry"],[59,49,74,25],[59,50,74,26,"pubDate"],[59,57,74,20],[59,60,74,36],[59,64,74,40,"Date"],[59,68,74,36],[59,69,74,45,"tmp"],[59,72,74,36],[59,73,74,20],[60,0,75,16],[60,17,75,23,"entry"],[60,22,75,16],[61,0,76,13],[61,9,57,25],[61,10,57,12],[62,0,77,9],[62,7,41,8],[62,13,77,15],[63,0,78,12,"childs"],[63,8,78,12,"childs"],[63,14,78,18],[63,17,78,21,"getOneElement"],[63,30,78,34],[63,31,78,35],[63,40,78,34],[63,42,78,46,"feedRoot"],[63,50,78,54],[63,51,78,55,"children"],[63,59,78,34],[63,60,78,21],[63,61,78,65,"children"],[63,69,78,12],[64,0,80,12,"feed"],[64,8,80,12,"feed"],[64,12,80,16],[64,13,80,17,"type"],[64,17,80,12],[64,20,80,24,"feedRoot"],[64,28,80,32],[64,29,80,33,"name"],[64,33,80,24],[64,34,80,38,"substr"],[64,40,80,24],[64,41,80,45],[64,42,80,24],[64,44,80,48],[64,45,80,24],[64,46,80,12],[65,0,81,12,"feed"],[65,8,81,12,"feed"],[65,12,81,16],[65,13,81,17,"id"],[65,15,81,12],[65,18,81,22],[65,20,81,12],[66,0,82,12,"addConditionally"],[66,8,82,12,"addConditionally"],[66,24,82,28],[66,25,82,29,"feed"],[66,29,82,28],[66,31,82,35],[66,38,82,28],[66,40,82,44],[66,47,82,28],[66,49,82,53,"childs"],[66,55,82,28],[66,56,82,12],[67,0,83,12,"addConditionally"],[67,8,83,12,"addConditionally"],[67,24,83,28],[67,25,83,29,"feed"],[67,29,83,28],[67,31,83,35],[67,37,83,28],[67,39,83,43],[67,45,83,28],[67,47,83,51,"childs"],[67,53,83,28],[67,54,83,12],[68,0,84,12,"addConditionally"],[68,8,84,12,"addConditionally"],[68,24,84,28],[68,25,84,29,"feed"],[68,29,84,28],[68,31,84,35],[68,44,84,28],[68,46,84,50],[68,59,84,28],[68,61,84,65,"childs"],[68,67,84,28],[68,68,84,12],[69,0,85,12],[69,12,85,17,"tmp"],[69,15,85,20],[69,18,85,23,"fetch"],[69,23,85,28],[69,24,85,29],[69,39,85,28],[69,41,85,46,"childs"],[69,47,85,28],[69,48,85,12],[69,50,86,16,"feed"],[69,54,86,20],[69,55,86,21,"updated"],[69,62,86,16],[69,65,86,31],[69,69,86,35,"Date"],[69,73,86,31],[69,74,86,40,"tmp"],[69,77,86,31],[69,78,86,16],[70,0,87,12,"addConditionally"],[70,8,87,12,"addConditionally"],[70,24,87,28],[70,25,87,29,"feed"],[70,29,87,28],[70,31,87,35],[70,39,87,28],[70,41,87,45],[70,57,87,28],[70,59,87,63,"childs"],[70,65,87,28],[70,67,87,71],[70,71,87,28],[70,72,87,12],[71,0,89,12,"feed"],[71,8,89,12,"feed"],[71,12,89,16],[71,13,89,17,"items"],[71,18,89,12],[71,21,89,25,"getElements"],[71,32,89,36],[71,33,89,37],[71,39,89,36],[71,41,89,45,"feedRoot"],[71,49,89,53],[71,50,89,54,"children"],[71,58,89,36],[71,59,89,25],[71,60,89,64,"map"],[71,63,89,25],[71,64,89,68],[71,74,90,16,"item"],[71,78,89,68],[71,80,91,14],[72,0,92,16],[72,14,92,20,"entry"],[72,19,92,25],[72,22,92,28],[72,24,92,16],[73,0,92,16],[73,14,93,20,"tmp"],[73,17,92,16],[74,0,95,16,"item"],[74,10,95,16,"item"],[74,14,95,20],[74,17,95,23,"item"],[74,21,95,27],[74,22,95,28,"children"],[74,30,95,16],[75,0,97,16,"addConditionally"],[75,10,97,16,"addConditionally"],[75,26,97,32],[75,27,97,33,"entry"],[75,32,97,32],[75,34,97,40],[75,38,97,32],[75,40,97,46],[75,46,97,32],[75,48,97,54,"item"],[75,52,97,32],[75,53,97,16],[76,0,98,16,"addConditionally"],[76,10,98,16,"addConditionally"],[76,26,98,32],[76,27,98,33,"entry"],[76,32,98,32],[76,34,98,40],[76,41,98,32],[76,43,98,49],[76,50,98,32],[76,52,98,58,"item"],[76,56,98,32],[76,57,98,16],[77,0,99,16,"addConditionally"],[77,10,99,16,"addConditionally"],[77,26,99,32],[77,27,99,33,"entry"],[77,32,99,32],[77,34,99,40],[77,40,99,32],[77,42,99,48],[77,48,99,32],[77,50,99,56,"item"],[77,54,99,32],[77,55,99,16],[78,0,100,16,"addConditionally"],[78,10,100,16,"addConditionally"],[78,26,100,32],[78,27,100,33,"entry"],[78,32,100,32],[78,34,100,40],[78,47,100,32],[78,49,100,55],[78,62,100,32],[78,64,100,70,"item"],[78,68,100,32],[78,69,100,16],[79,0,101,16],[79,14,101,21,"tmp"],[79,17,101,24],[79,20,101,27,"fetch"],[79,25,101,32],[79,26,101,33],[79,35,101,32],[79,37,101,44,"item"],[79,41,101,32],[79,42,101,16],[79,44,102,20,"entry"],[79,49,102,25],[79,50,102,26,"pubDate"],[79,57,102,20],[79,60,102,36],[79,64,102,40,"Date"],[79,68,102,36],[79,69,102,45,"tmp"],[79,72,102,36],[79,73,102,20],[80,0,103,16],[80,17,103,23,"entry"],[80,22,103,16],[81,0,104,13],[81,9,89,25],[81,10,89,12],[82,0,105,9],[83,0,106,5],[85,0,107,4],[85,9,107,9,"dom"],[85,12,107,4],[85,15,107,15,"feed"],[85,19,107,4],[87,0,108,4,"DomHandler"],[87,4,108,4,"DomHandler"],[87,14,108,14],[87,15,108,15,"prototype"],[87,24,108,4],[87,25,108,25,"_handleCallback"],[87,40,108,4],[87,41,108,41,"call"],[87,45,108,4],[87,46,109,8],[87,50,108,4],[87,52,110,8,"feedRoot"],[87,60,110,16],[87,63,110,19],[87,67,110,16],[87,70,110,26,"Error"],[87,75,110,31],[87,76,110,32],[87,104,110,31],[87,105,108,4],[88,0,112,1],[88,3,34,0],[90,0,114,0,"module"],[90,2,114,0,"module"],[90,8,114,6],[90,9,114,7,"exports"],[90,16,114,0],[90,19,114,17,"FeedHandler"],[90,30,114,0]]},"type":"js/module"}]}